generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model attendance_records {
  id                      BigInt                     @id @default(autoincrement()) @db.UnsignedBigInt
  internship_id           BigInt                     @db.UnsignedBigInt
  attendance_date         DateTime                   @db.Date
  check_in_time           DateTime?                  @db.Time(0)
  check_out_time          DateTime?                  @db.Time(0)
  status                  attendance_records_status? @default(present)
  approved_by_lecturer_id BigInt?                    @db.UnsignedBigInt
  approved_at             DateTime?                  @db.Timestamp(0)
  note                    String?                    @db.VarChar(500)
  created_at              DateTime?                  @default(now()) @db.Timestamp(0)
  lecturers               lecturers?                 @relation(fields: [approved_by_lecturer_id], references: [id], map: "fk_attendance_approved_lecturer")
  internships             internships                @relation(fields: [internship_id], references: [id], onDelete: Cascade, map: "fk_attendance_internship")

  @@unique([internship_id, attendance_date], map: "uq_attendance_unique")
  @@index([approved_by_lecturer_id], map: "fk_attendance_approved_lecturer")
}

model classes {
  id          BigInt     @id @default(autoincrement()) @db.UnsignedBigInt
  class_code  String     @unique(map: "class_code") @db.VarChar(50)
  class_name  String     @db.VarChar(255)
  course_year Int?
  major       String?    @db.VarChar(255)
  created_at  DateTime?  @default(now()) @db.Timestamp(0)
  students    students[]
}

model comments {
  id             BigInt      @id @default(autoincrement()) @db.UnsignedBigInt
  internship_id  BigInt      @db.UnsignedBigInt
  author_user_id BigInt      @db.UnsignedBigInt
  content        String      @db.Text
  created_at     DateTime?   @default(now()) @db.Timestamp(0)
  users          users       @relation(fields: [author_user_id], references: [id], onDelete: Cascade, map: "fk_comments_author")
  internships    internships @relation(fields: [internship_id], references: [id], onDelete: Cascade, map: "fk_comments_internship")

  @@index([author_user_id], map: "fk_comments_author")
  @@index([internship_id], map: "fk_comments_internship")
}

model final_evaluations {
  id            BigInt      @id @default(autoincrement()) @db.UnsignedBigInt
  internship_id BigInt      @unique(map: "uq_final_eval_unique") @db.UnsignedBigInt
  lecturer_id   BigInt      @db.UnsignedBigInt
  final_grade   Decimal?    @db.Decimal(5, 2)
  summary       String?     @db.Text
  created_at    DateTime?   @default(now()) @db.Timestamp(0)
  internships   internships @relation(fields: [internship_id], references: [id], onDelete: Cascade, map: "fk_final_eval_internship")
  lecturers     lecturers   @relation(fields: [lecturer_id], references: [id], onDelete: Cascade, map: "fk_final_eval_lecturer")

  @@index([lecturer_id], map: "fk_final_eval_lecturer")
}

model internship_terms {
  id                           BigInt        @id @default(autoincrement()) @db.UnsignedBigInt
  term_name                    String        @db.VarChar(255)
  start_date                   DateTime      @db.Date
  end_date                     DateTime      @db.Date
  total_weeks                  Int?          @default(12) @db.UnsignedTinyInt
  min_attendance_days_per_week Int?          @default(3) @db.UnsignedTinyInt
  min_reports                  Int?          @default(3) @db.UnsignedTinyInt
  created_at                   DateTime?     @default(now()) @db.Timestamp(0)
  internships                  internships[]
}

model internship_topics {
  id                     BigInt        @id @default(autoincrement()) @db.UnsignedBigInt
  title                  String        @db.VarChar(255)
  description            String?       @db.Text
  company_name           String?       @db.VarChar(255)
  company_address        String?       @db.VarChar(255)
  created_by_lecturer_id BigInt?       @db.UnsignedBigInt
  created_at             DateTime?     @default(now()) @db.Timestamp(0)
  lecturers              lecturers?    @relation(fields: [created_by_lecturer_id], references: [id], map: "fk_topics_lecturer")
  internships            internships[]

  @@index([created_by_lecturer_id], map: "fk_topics_lecturer")
}

model internships {
  id                 BigInt               @id @default(autoincrement()) @db.UnsignedBigInt
  student_id         BigInt               @db.UnsignedBigInt
  lecturer_id        BigInt               @db.UnsignedBigInt
  term_id            BigInt               @db.UnsignedBigInt
  topic_id           BigInt               @db.UnsignedBigInt
  status             internships_status?  @default(registered)
  start_date         DateTime?            @db.Date
  end_date           DateTime?            @db.Date
  progress_percent   Decimal?             @default(0.00) @db.Decimal(5, 2)
  created_at         DateTime?            @default(now()) @db.Timestamp(0)
  updated_at         DateTime?            @default(now()) @db.Timestamp(0)
  attendance_records attendance_records[]
  comments           comments[]
  final_evaluations  final_evaluations?
  lecturers          lecturers            @relation(fields: [lecturer_id], references: [id], onDelete: Cascade, map: "fk_internships_lecturer")
  students           students             @relation(fields: [student_id], references: [id], onDelete: Cascade, map: "fk_internships_student")
  internship_terms   internship_terms     @relation(fields: [term_id], references: [id], onDelete: Cascade, map: "fk_internships_term")
  internship_topics  internship_topics    @relation(fields: [topic_id], references: [id], onDelete: Cascade, map: "fk_internships_topic")
  progress_reports   progress_reports[]
  work_logs          work_logs[]

  @@unique([student_id, term_id], map: "uq_internship_student_term")
  @@index([lecturer_id], map: "fk_internships_lecturer")
  @@index([term_id], map: "fk_internships_term")
  @@index([topic_id], map: "fk_internships_topic")
}

model lecturers {
  id                 BigInt               @id @default(autoincrement()) @db.UnsignedBigInt
  user_id            BigInt               @unique @db.UnsignedBigInt
  lecturer_code      String?              @unique(map: "lecturer_code") @db.VarChar(50)
  department         String?              @db.VarChar(255)
  phone              String?              @db.VarChar(20)
  created_at         DateTime?            @default(now()) @db.Timestamp(0)
  attendance_records attendance_records[]
  final_evaluations  final_evaluations[]
  internship_topics  internship_topics[]
  internships        internships[]
  users              users                @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_lecturers_user")
  progress_reports   progress_reports[]

  @@index([user_id], map: "fk_lecturers_user")
}

model notifications {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  user_id    BigInt    @db.UnsignedBigInt
  type       String    @db.VarChar(100)
  title      String    @db.VarChar(255)
  message    String    @db.Text
  link_url   String?   @db.VarChar(500)
  is_read    Boolean   @default(false)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_notifications_user")

  @@index([user_id], map: "fk_notifications_user")
}

model progress_reports {
  id                      BigInt                   @id @default(autoincrement()) @db.UnsignedBigInt
  internship_id           BigInt                   @db.UnsignedBigInt
  report_no               Int?                     @db.UnsignedTinyInt
  title                   String                   @db.VarChar(255)
  content                 String                   @db.Text
  submitted_at            DateTime?                @default(now()) @db.Timestamp(0)
  status                  progress_reports_status? @default(submitted)
  reviewed_by_lecturer_id BigInt?                  @db.UnsignedBigInt
  reviewed_at             DateTime?                @db.Timestamp(0)
  score                   Decimal?                 @db.Decimal(5, 2)
  feedback                String?                  @db.Text
  internships             internships              @relation(fields: [internship_id], references: [id], onDelete: Cascade, map: "fk_reports_internship")
  lecturers               lecturers?               @relation(fields: [reviewed_by_lecturer_id], references: [id], map: "fk_reports_lecturer")
  report_attachments      report_attachments[]

  @@index([internship_id], map: "fk_reports_internship")
  @@index([reviewed_by_lecturer_id], map: "fk_reports_lecturer")
}

model report_attachments {
  id               BigInt           @id @default(autoincrement()) @db.UnsignedBigInt
  report_id        BigInt           @db.UnsignedBigInt
  file_path        String           @db.VarChar(500)
  description      String?          @db.VarChar(255)
  uploaded_at      DateTime?        @default(now()) @db.Timestamp(0)
  progress_reports progress_reports @relation(fields: [report_id], references: [id], onDelete: Cascade, map: "fk_report_attachments_report")

  @@index([report_id], map: "fk_report_attachments_report")
}

model students {
  id           BigInt        @id @default(autoincrement()) @db.UnsignedBigInt
  user_id      BigInt        @db.UnsignedBigInt
  student_code String        @unique(map: "student_code") @db.VarChar(50)
  class_id     BigInt?       @db.UnsignedBigInt
  phone        String?       @db.VarChar(20)
  created_at   DateTime?     @default(now()) @db.Timestamp(0)
  internships  internships[]
  classes      classes?      @relation(fields: [class_id], references: [id], map: "fk_students_class")
  users        users         @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_students_user")

  @@index([class_id], map: "fk_students_class")
  @@index([user_id], map: "fk_students_user")
}

model users {
  id            BigInt          @id @default(autoincrement()) @db.UnsignedBigInt
  full_name     String          @db.VarChar(255)
  email         String          @unique(map: "email") @db.VarChar(255)
  password_hash String          @db.VarChar(255)
  role          users_role
  is_active     Boolean         @default(true)
  created_at    DateTime?       @default(now()) @db.Timestamp(0)
  updated_at    DateTime?       @default(now()) @db.Timestamp(0)
  comments      comments[]
  lecturers     lecturers?
  notifications notifications[]
  students      students[]
}

model work_log_attachments {
  id          BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  work_log_id BigInt    @db.UnsignedBigInt
  file_path   String    @db.VarChar(500)
  description String?   @db.VarChar(255)
  uploaded_at DateTime? @default(now()) @db.Timestamp(0)
  work_logs   work_logs @relation(fields: [work_log_id], references: [id], onDelete: Cascade, map: "fk_worklog_attachments_worklog")

  @@index([work_log_id], map: "fk_worklog_attachments_worklog")
}

model work_logs {
  id                   BigInt                 @id @default(autoincrement()) @db.UnsignedBigInt
  internship_id        BigInt                 @db.UnsignedBigInt
  work_date            DateTime               @db.Date
  content              String                 @db.Text
  created_at           DateTime?              @default(now()) @db.Timestamp(0)
  work_log_attachments work_log_attachments[]
  internships          internships            @relation(fields: [internship_id], references: [id], onDelete: Cascade, map: "fk_worklogs_internship")

  @@index([internship_id], map: "fk_worklogs_internship")
}

enum users_role {
  student
  lecturer
  admin
}

enum attendance_records_status {
  present
  absent
  late
  excused
}

enum internships_status {
  registered
  in_progress
  completed
  dropped
}

enum progress_reports_status {
  submitted
  reviewed
  needs_revision
}
